<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) with consent -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-MYJRPRS3TW"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    
    // Set default consent state
    gtag('consent', 'default', {
      'analytics_storage': 'denied'
    });
    
    gtag('js', new Date());
    gtag('config', 'G-MYJRPRS3TW');
  </script>
  <meta charset="utf-8">
  <title>AGA8-92DC Z-Faktor Rechner | Erdgas-Kompressibilität</title>
  <link rel="canonical" href="https://gas-flows.com/de/aga8.html">
  <meta name="description" content="Berechnen Sie Z‑Faktoren und Gasdichte für Erdgasgemische mit der AGA8‑92DC‑Gleichung. Online‑Rechner für den Kompressibilitätsfaktor.">
  <meta name="keywords" content="AGA8 calculator, AGA8-92DC, z-factor calculator, compressibility factor calculator, natural gas calculator, gas density calculator, molar density, mass density, natural gas compressibility, gas mixture calculation, ISO 12213, what is z-factor, how to calculate z-factor, AGA8 formula, gas properties calculator">

<link rel="apple-touch-icon" sizes="57x57" href="../icons/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../icons/apple-icon-60x60.png">
<link rel="icon" type="image/png" sizes="16x16" href="../icons/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="36x36" href="../icons/android-icon-36x36.png">
<link rel="icon" type="image/png" sizes="48x48" href="../icons/android-icon-48x48.png">
  <link rel="manifest" href="../manifest.json">
<link rel="stylesheet" href="../common.css">
  <script src="../js/lang.js"></script>
  
</head>

<body>
  
  <nav>
    <ul>
      <li><a href="index.html">Durchflussrechner</a></li>
      <li><a href="pressures.html">Einheitenumrechner</a></li>
      <li><a href="aga8.html" class="active">AGA8 Z‑Faktor</a></li>
      <li><a href="AGA8Flow.html">AGA8 Durchfluss</a></li>
      <li><a href="simulator.html">Gassimulator</a></li>
      <li><a href="contacts.html">Kontakt</a></li>
    </ul>
  </nav>

  <div id="controls" style="margin-bottom: 16px;">
    <button id="groupedOrder" class="controlButton">Gruppierte Reihenfolge</button>
    <button id="AGAOrder" class="controlButton">AGA8‑Reihenfolge</button>
    <button id="resetButton" class="controlButton">Zurücksetzen</button>
  </div>

  <div class="container">
    <h2>AGA8‑92DC Kompressibilitätsfaktor‑Rechner</h2>

    <div class="field-group">
      <label for="temperature">Temperatur (°C):</label>
      <input type="number" id="temperature" value="7" step="1">
      <span>Gastemperatur</span>
    </div>

    <div class="field-group">
      <label for="pressure">Druck (barA):</label>
      <input type="number" id="pressure" value="120" step="1">
      <span>Betriebsdruck</span>
    </div>

    <!-- Mole fractions: indexed 0..20, Russian order -->
<div class="field-group">
  <label for="mol_methane">Methan</label>
  <input id="mol_methane" type="number" step="1e-5" value="0.9659">
  <span>Methan (CH₄)</span>
</div>
<div class="field-group">
  <label for="mol_ethane">Ethan</label>
  <input id="mol_ethane" type="number" step="1e-5" value="0.02751">
  <span>Ethan (C₂H₆)</span>
</div>
<div class="field-group">
  <label for="mol_propane">Propan</label>
  <input id="mol_propane" type="number" step="1e-5" value="0.00046">
  <span>Propan (C₃H₈)</span>
</div>
<div class="field-group">
  <label for="mol_isobutane">Isobutan</label>
  <input id="mol_isobutane" type="number" step="1e-5" value="0.00046">
  <span>Isobutan (i‑C₄H₁₀)</span>
</div>
<div class="field-group">
  <label for="mol_n-butane">n‑Butan</label>
  <input id="mol_n-butane" type="number" step="1e-5" value="0.00010">
  <span>n‑Butan (n‑C₄H₁₀)</span>
</div>
<div class="field-group">
  <label for="mol_isopentane">Isopentan</label>
  <input id="mol_isopentane" type="number" step="1e-5" value="0.00004">
  <span>Isopentan (i‑C₅H₁₂)</span>
</div>
<div class="field-group">
  <label for="mol_n-pentane">n‑Pentan</label>
  <input id="mol_n-pentane" type="number" step="1e-5" value="0.00002">
  <span>n‑Pentan (n‑C₅H₁₂)</span>
</div>
<div class="field-group">
  <label for="mol_n-hexane">n‑Hexan</label>
  <input id="mol_n-hexane" type="number" step="1e-5" value="0.00002">
  <span>n‑Hexan (n‑C₆H₁₄)</span>
</div>
<div class="field-group">
  <label for="mol_n-heptane">n‑Heptan</label>
  <input id="mol_n-heptane" type="number" step="1e-5" value="0.0">
  <span>n‑Heptan (n‑C₇H₁₆)</span>
</div>
<div class="field-group">
  <label for="mol_n-octane">n‑Oktan</label>
  <input id="mol_n-octane" type="number" step="1e-5" value="0.0">
  <span>n‑Oktan (n‑C₈H₁₈)</span>
</div>
<div class="field-group">
  <label for="mol_n-nonane">n‑Nonan</label>
  <input id="mol_n-nonane" type="number" step="1e-5" value="0.0">
  <span>n‑Nonan (n‑C₉H₂₀)</span>
</div>
<div class="field-group">
  <label for="mol_n-decane">n‑Dekan</label>
  <input id="mol_n-decane" type="number" step="1e-5" value="0.0">
  <span>n‑Dekan (n‑C₁₀H₂₂)</span>
</div>
<div class="field-group">
  <label for="mol_helium">Helium</label>
  <input id="mol_helium" type="number" step="1e-5" value="0.0">
  <span>Helium (He)</span>
</div>
<div class="field-group">
  <label for="mol_argon">Argon</label>
  <input id="mol_argon" type="number" step="1e-5" value="0.0">
  <span>Argon (Ar)</span>
</div>
<div class="field-group">
  <label for="mol_nitrogen">Stickstoff</label>
  <input id="mol_nitrogen" type="number" step="1e-5" value="0.002">
  <span>Stickstoff (N₂)</span>
</div>
<div class="field-group">
  <label for="mol_oxygen">Sauerstoff</label>
  <input id="mol_oxygen" type="number" step="1e-5" value="0.0">
  <span>Sauerstoff (O₂)</span>
</div>
<div class="field-group">
  <label for="mol_carbon-monoxide">Kohlenmonoxid</label>
  <input id="mol_carbon-monoxide" type="number" step="1e-5" value="0.0">
  <span>Kohlenmonoxid (CO)</span>
</div>
<div class="field-group">
  <label for="mol_carbon-dioxide">Kohlendioxid</label>
  <input id="mol_carbon-dioxide" type="number" step="1e-5" value="0.00349">
  <span>Kohlendioxid (CO₂)</span>
</div>
<div class="field-group">
  <label for="mol_hydrogen">Wasserstoff</label>
  <input id="mol_hydrogen" type="number" step="1e-5" value="0.0">
  <span>Wasserstoff (H₂)</span>
</div>
<div class="field-group">
  <label for="mol_water">Wasser</label>
  <input id="mol_water" type="number" step="1e-5" value="0.0">
  <span>Wasser (H₂O)</span>
</div>
<div class="field-group">
  <label for="mol_hydrogen-sulfide">Schwefelwasserstoff</label>
  <input id="mol_hydrogen-sulfide" type="number" step="1e-5" value="0.0">
  <span>Schwefelwasserstoff (H₂S)</span>
</div>

    <h2>Ergebnisse</h2>
	
<div class="field-group">
  <label for="sumResult">Summe der Komponenten:</label>
  <input type="text" id="sumResult" readonly>
  <span>Summe aller Stoffmengenanteile</span>
</div>

<div class="field-group">
  <label for="densityResult">Molardichte:</label>
  <input type="text" id="densityResult" readonly>
  <span>Molardichte (mol/m³)</span>
</div>

<div class="field-group">
  <label for="relativeResult">Relative Dichte:</label>
  <input type="text" id="relativeResult" readonly>
  <span>Luftbezogene Molekülmasse (Luft ≈ 28.9647 g/mol)</span>
</div>

<div class="field-group">
  <label for="massDensityResult">Massendichte:</label>
  <input type="text" id="massDensityResult" readonly>
  <span>Massendichte (kg/m³)</span>
</div>

<div class="field-group">
  <label for="massDensityBaseResult">Dichte bei Normbedingungen:</label>
  <input type="text" id="massDensityBaseResult" readonly>
  <span>Dichte bei Standardbedingungen (kg·m⁻³) (@ 20 °C, 101.325 kPa)</span>
</div>

<div class="field-group">
  <label for="zResult">Z‑Faktor:</label>
  <input type="text" id="zResult" readonly>
  <span>Berechnete Kompressibilität</span>
</div>

  </div>
  


<div class="container">
	<div class="field-group">
	  <canvas id="zChart" width="600" height="300"></canvas>
	</div>
</div>

<div class="container">
  <div class="field-group">
    <p><strong>AGA8 Details</strong><br>
    AGA8 ist die Standard‑Zustandsgleichung der American Gas Association zur Berechnung der Kompressibilität (Z‑Faktor) und 
      der Dichte von Erdgas aus Zusammensetzung, Druck und Temperatur. 
      Sie ermöglicht genaue Messungen von Gasdurchfluss und Volumen in Rohrleitungen sowie bei der Übergabemessung. 
      Der Standard wird in der Öl‑ und Gasindustrie breit eingesetzt und ist für die internationale Nutzung mit ISO 12213 abgestimmt.<br><br>
      
      ISO 12213 besteht aus drei Teilen: Teil 1 enthält allgemeine Richtlinien, Teil 2 beschreibt die detaillierte Methode (AGA8 Detail), 
      und Teil 3 behandelt die vereinfachte Methode (Gross) für einfachere Anwendungen.<br><br>
      
      <strong>AGA8 Anwendungsgrenzen:</strong><br>
      Druck: 0 MPa bis 12 MPa (0 bis 120 bar)<br>
      Temperatur: 263 K bis 338 K (‑10 °C bis 65 °C)<br>
      Oberer Heizwert: 30 MJ/m³ bis 45 MJ/m³<br>
      Relative Dichte: 0.55 bis 0.80<br><br>
      
      <strong>AGA8 Referenzen:</strong><br>
    <a href="https://github.com/MiroslavDressler/AGA8/blob/master/ISO_12213-2.pdf" target="_blank" class="modern-link">ISO 12213‑2:1997 Standard (PDF)</a><br>
    <a href="https://github.com/usnistgov/AGA8" target="_blank" class="modern-link">NIST‑Repository für AGA 8</a><br>
    <a href="https://pages.nist.gov/AGA8/" target="_blank" class="modern-link">Repository mit ergänzenden Dateien zu AGA 8</a><br>
    <a href="https://www.iso.org/standard/44411.html" target="_blank" class="modern-link">Offizielle Seite zum Standard ISO 12213‑2:1997 (kostenpflichtig)</a><br>
    <a href="https://github.com/MiroslavDressler/AGA8" target="_blank" class="modern-link">Repository für FORTRAN, PASCAL und C</a><br>
    <a href="https://github.com/Dseal95/AGA8-Detail" target="_blank" class="modern-link">Community‑Python‑Implementierung von AGA8 Detail</a><br>
    <a href="https://pypi.org/project/pyaga8/" target="_blank" class="modern-link">Python‑Paket zur Berechnung von Gaseigenschaften mit AGA8</a><br>
  </div>
</div>

 <div class="container">

  <label>Validierungsergebnisse:</label>
  <pre id="validationResults" style="background:#f9f9f9;padding:10px;border:1px solid #ccc;max-height:120px;overflow:auto;"></pre>

</div>

    <!-- Load the AGA8 library as a regular script -->
<script src="../js/constants.js"></script>
<script src="../js/aga8.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Cookie Consent -->
<script src="../js/cookies.js"></script>

  <!-- Your calculation logic -->
<!-- Only the bottom part is changed; top remains unchanged -->
<!-- Main calculation logic -->
<script>
/* ------------------------------------------------------------------
   AGA8‑92DC front‑end helper
   – collects 14 user mole‑fraction inputs,
   – builds the 21‑component XJ vector in ISO order,
   – calls compressibilityFactor(xj, T [K], P [MPa]) from aga8.js,
   – displays Z, molar & mass density, and rel. density to air,
     plus a quick Z‑vs‑P chart (0‑250 bar).
------------------------------------------------------------------ */

// Define the component orders
const GROUPED_ORDER = [
  'methane', 'ethane', 'propane', 'isobutane', 'n-butane', 
  'isopentane', 'n-pentane', 'n-hexane', 'n-heptane', 'n-octane',
  'n-nonane', 'n-decane', 'helium', 'argon', 'nitrogen',
  'oxygen', 'carbon-monoxide', 'carbon-dioxide', 'hydrogen',
  'water', 'hydrogen-sulfide'
];

const AGA8_ORDER = [
  'methane', 'nitrogen', 'carbon-dioxide', 'ethane', 'propane',
  'water', 'hydrogen-sulfide', 'hydrogen', 'carbon-monoxide', 'oxygen',
  'isobutane', 'n-butane', 'isopentane', 'n-pentane', 'n-hexane',
  'n-heptane', 'n-octane', 'n-nonane', 'n-decane', 'helium', 'argon'
];

// Function to reorder components
function reorderComponents(order) {
  const container = document.querySelector('.container');
  const components = Array.from(container.querySelectorAll('.field-group')).filter(
    div => div.querySelector('input[id^="mol_"]')
  );
  
  // Create a map of component divs by their ID
  const componentMap = {};
  components.forEach(div => {
    const input = div.querySelector('input[id^="mol_"]');
    const id = input.id.replace('mol_', '');
    componentMap[id] = div;
  });

  // Remove all component divs
  components.forEach(div => div.remove());

  // Add them back in the new order
  order.forEach(id => {
    if (componentMap[id]) {
      container.insertBefore(componentMap[id], document.querySelector('h2:last-of-type'));
    }
  });
}

// Function to update button active states
function updateButtonStates(activeButton) {
  const buttons = document.querySelectorAll('.controlButton');
  buttons.forEach(button => button.classList.remove('active'));
  activeButton.classList.add('active');
}

// Add event listeners for the order buttons
document.getElementById('groupedOrder').addEventListener('click', function() {
  reorderComponents(GROUPED_ORDER);
  updateButtonStates(this);
  saveOrderMode('grouped');
});

document.getElementById('AGAOrder').addEventListener('click', function() {
  reorderComponents(AGA8_ORDER);
  updateButtonStates(this);
  saveOrderMode('aga8');
});

// --- Persistence logic for user inputs ---
const STORAGE_KEY = 'aga8UserInputs';
const ORDER_KEY = 'aga8OrderMode';

function saveUserInputs() {
  const data = {
    temperature: document.getElementById('temperature').value,
    pressure: document.getElementById('pressure').value,
  };
  [
    'methane', 'ethane', 'propane', 'isobutane', 'n-butane',
    'isopentane', 'n-pentane', 'n-hexane', 'n-heptane', 'n-octane',
    'n-nonane', 'n-decane', 'helium', 'argon', 'nitrogen',
    'oxygen', 'carbon-monoxide', 'carbon-dioxide', 'hydrogen',
    'water', 'hydrogen-sulfide'
  ].forEach(id => {
    const input = document.getElementById('mol_' + id);
    if (input) data[id] = input.value;
  });
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

function saveOrderMode(mode) {
  localStorage.setItem(ORDER_KEY, mode);
}

function loadOrderMode() {
  return localStorage.getItem(ORDER_KEY);
}

function clearOrderMode() {
  localStorage.removeItem(ORDER_KEY);
}

function loadUserInputs() {
  const data = localStorage.getItem(STORAGE_KEY);
  if (!data) return;
  try {
    const vals = JSON.parse(data);
    if (vals.temperature !== undefined) document.getElementById('temperature').value = vals.temperature;
    if (vals.pressure !== undefined) document.getElementById('pressure').value = vals.pressure;
    [
      'methane', 'ethane', 'propane', 'isobutane', 'n-butane',
      'isopentane', 'n-pentane', 'n-hexane', 'n-heptane', 'n-octane',
      'n-nonane', 'n-decane', 'helium', 'argon', 'nitrogen',
      'oxygen', 'carbon-monoxide', 'carbon-dioxide', 'hydrogen',
      'water', 'hydrogen-sulfide'
    ].forEach(id => {
      if (vals[id] !== undefined) {
        const input = document.getElementById('mol_' + id);
        if (input) input.value = vals[id];
      }
    });
  } catch {}
}

function clearUserInputs() {
  localStorage.removeItem(STORAGE_KEY);
}

// Set Grouped Order as active by default
window.addEventListener('DOMContentLoaded', () => {
  loadUserInputs(); // Restore saved values if present
  // Restore order mode if present
  const savedOrder = loadOrderMode();
  if (savedOrder === 'aga8') {
    reorderComponents(AGA8_ORDER);
    updateButtonStates(document.getElementById('AGAOrder'));
  } else {
    reorderComponents(GROUPED_ORDER);
    updateButtonStates(document.getElementById('groupedOrder'));
  }
  calculateZ();  // auto‑calculate on page load
  document.querySelectorAll(
    '#temperature, #pressure, input[id^="mol_"]'
  ).forEach(el => el.addEventListener('input', () => {
    calculateZ();
    saveUserInputs();
  }));
});

function calculateZ () {
    const tol          = 1e-6;
    const molInputs    = [];
    let   moleSum      = 0;

    // gather 21 user mole‑fraction inputs
    const componentIds = [
        'methane', 'ethane', 'propane', 'isobutane', 'n-butane', 
        'isopentane', 'n-pentane', 'n-hexane', 'n-heptane', 'n-octane',
        'n-nonane', 'n-decane', 'helium', 'argon', 'nitrogen',
        'oxygen', 'carbon-monoxide', 'carbon-dioxide', 'hydrogen',
        'water', 'hydrogen-sulfide'
    ];

    for (const id of componentIds) {
      let input = document.getElementById('mol_' + id);
      let v = parseFloat(input.value);
      if (isNaN(v) || v < 0) {
        v = 0;
        input.value = "0.0";
      } else if (v > 1) {
        v = 1;
        input.value = "0.0";
      }
      molInputs.push(v);
      moleSum += v;
    }

    // result fields
    const zField       = document.getElementById('zResult');
    const densityField = document.getElementById('densityResult');
    const massField    = document.getElementById('massDensityResult');
    const relField     = document.getElementById('relativeResult');
    const baseField    = document.getElementById('massDensityBaseResult');
    const sumField     = document.getElementById('sumResult');

    // display sum of mole fractions
    if (Math.abs(moleSum - 1) > tol) {
      sumField.value = moleSum.toFixed(6) + ' ❌';
    } else {
      sumField.value = moleSum.toFixed(6);
    }

    // temperature & pressure (operating)
    const T_C  = parseFloat(document.getElementById('temperature').value);
    const T    = T_C + 273.15;                // K
    const Pbar = parseFloat(document.getElementById('pressure').value);
    const P    = Pbar * 0.1;                  // MPa  (1 bar = 0.1 MPa)

    if (Math.abs(moleSum - 1) > tol) {
      zField.value = '';
      densityField.value = massField.value = relField.value = baseField.value = '';
      if (window.zChart instanceof Chart) window.zChart.destroy();
      return;
    }

    // use the 21-component vector directly
    const xj = molInputs;

    try {
      /* ── operating conditions ─────────────────────────────────────── */
      const { Z, D } = compressibilityFactor(xj, T, P); // D → kmol·m⁻³
      zField.value       = Z.toFixed(5);
      densityField.value = D.toFixed(4);

      const M_mix = calculateMolarMass(xj);            // g·mol⁻¹
      const rho   = D * M_mix;                         // kg·m⁻³ (D kmol/m³ × g/mol × 1 kg/1000 g × 1000 mol/kmol)
      massField.value = rho.toFixed(3);

      relField.value = (M_mix / 28.9647).toFixed(3);

      /* ── base‑condition density (20 °C & 101.325 kPa) ─────────────── */
      const Tbase = 293.15;          // 20 °C in K
      const Pbase = 0.101325;        // 101.325 kPa = 0.101325 MPa
      const { D: Dbase } = compressibilityFactor(xj, Tbase, Pbase);
      const rhoBase = Dbase * M_mix; // kg·m⁻³
      baseField.value = rhoBase.toFixed(3);

      updateZChart(xj, T);
    } catch (err) {
      zField.value = `Error: ${err.message} ❌`;
      densityField.value = massField.value = relField.value = baseField.value = '';
      if (window.zChart instanceof Chart) window.zChart.destroy();
    }
  }

  function calculateMolarMass (xj) {
    // Map from grouped order (xj) to ISO order (MW array)
    // xj order: methane, ethane, propane, isobutane, n-butane, isopentane, n-pentane, n-hexane, n-heptane, n-octane, n-nonane, n-decane, helium, argon, nitrogen, oxygen, carbon-monoxide, carbon-dioxide, hydrogen, water, hydrogen-sulfide
    // MW order: methane, nitrogen, carbon-dioxide, ethane, propane, water, hydrogen-sulfide, hydrogen, carbon-monoxide, oxygen, isobutane, n-butane, isopentane, n-pentane, n-hexane, n-heptane, n-octane, n-nonane, n-decane, helium, argon
    const MW_INDICES = [0, 3, 4, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 1, 9, 8, 2, 7, 5, 6];
    return xj.reduce((sum, x, i) => sum + x * MW[MW_INDICES[i]], 0);
  }

/* ─── Helpers ──────────────────────────────────────────────────── */

function updateZChart(xj, T) {
  const pressures = [];
  const zValues   = [];

  for (let pb = 0; pb <= 250; pb += 5) {
    const MPa = pb * 0.1;
    try {
      const { Z } = compressibilityFactor(xj, T, MPa);
      pressures.push(pb);
      zValues.push(Z);
    } catch {
      pressures.push(pb);
      zValues.push(null);   // missing point if solver fails (rare)
    }
  }

  const ctx = document.getElementById('zChart').getContext('2d');
  if (window.zChart instanceof Chart) window.zChart.destroy();

  window.zChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: pressures,
      datasets: [{
        label: 'Z‑Faktor vs. Druck (bar)',
        data: zValues,
        borderWidth: 2,
        borderColor: 'blue',
        fill: false,
        pointRadius: 0
      }]
    },
    options: {
      responsive: true,
      animation: false,
      scales: {
        x: { title: { display: true, text: 'Pressure (bar)' } },
        y: { title: { display: true, text: 'Z‑Factor' }, beginAtZero: false }
      },
      plugins: { legend: { display: true } }
    }
  });
}

/* ─── Initialise ───────────────────────────────────────────────── */
window.addEventListener('DOMContentLoaded', () => {
  calculateZ();  // auto‑calculate on page load
  document.querySelectorAll(
    '#temperature, #pressure, input[id^="mol_"]'
  ).forEach(el => el.addEventListener('input', calculateZ));
});

/* --- ISO Annex F – six reference mixtures ----------------------------- */
/* order inside each array:                                             */
/*  CO2, N2, H2, CO, CH4, C2H6, C3H8, i‑C4, n‑C4, i‑C5, n‑C5, C6, C7, C8 */

const gasCompositions = [
  // [Methane, Ethane, Propane, Isobutane, n-Butane, Isopentane, n-Pentane, n-Hexane, n-Heptane, n-Octane, n-Nonane, n-Decane,
  //  Helium, Argon, Nitrogen, Oxygen, Carbon Monoxide, Carbon Dioxide, Hydrogen, Water, Hydrogen Sulfide]
  [0.965, 0.0180, 0.0045, 0.0010, 0.0010, 0.0005, 0.0003, 0.0007, 0.0000, 0.0000, 0, 0, 0, 0, 0.003, 0, 0.0000, 0.006, 0.000, 0, 0],
  [0.907, 0.0450, 0.0084, 0.0010, 0.0015, 0.0003, 0.0004, 0.0004, 0.0000, 0.0000, 0, 0, 0, 0, 0.031, 0, 0.0000, 0.005, 0.000, 0, 0],
  [0.859, 0.0850, 0.0230, 0.0035, 0.0035, 0.0005, 0.0005, 0.0002, 0.0000, 0.0000, 0, 0, 0, 0, 0.010, 0, 0.0000, 0.015, 0.000, 0, 0],
  [0.735, 0.0330, 0.0074, 0.0012, 0.0012, 0.0004, 0.0004, 0.0002, 0.0001, 0.0001, 0, 0, 0, 0, 0.100, 0, 0.010, 0.016, 0.095, 0, 0],
  [0.812, 0.0430, 0.0090, 0.0015, 0.0015, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0, 0, 0, 0, 0.057, 0, 0.0000, 0.076, 0.000, 0, 0],
  [0.826, 0.0350, 0.0075, 0.0012, 0.0012, 0.0004, 0.0004, 0.0002, 0.0001, 0.0000, 0, 0, 0, 0, 0.117, 0, 0.0000, 0.011, 0.000, 0, 0]
];

const testCases = [
  { pBar: 60,  tC: -3.15, expected: [0.84053,0.83348,0.79380,0.88550,0.82609,0.85380] },
  { pBar: 60,  tC: 6.85,  expected: [0.86199,0.85596,0.82206,0.90144,0.84969,0.87370] },
  { pBar: 60,  tC: 36.85, expected: [0.90867,0.90466,0.88183,0.93674,0.90052,0.91723] },
  { pBar: 60,  tC: 56.85, expected: [0.93011,0.92696,0.90868,0.95318,0.92368,0.93730] },
  { pBar: 120, tC: -3.15, expected: [0.72133,0.71044,0.64145,0.81020,0.69540,0.75074] },
  { pBar: 120, tC: 6.85,  expected: [0.76025,0.75061,0.68971,0.83762,0.73780,0.78586] },
  { pBar: 120, tC: 16.85, expected: [0.79317,0.78475,0.73123,0.86137,0.77369,0.81569] },
  { pBar: 120, tC: 36.85, expected: [0.84515,0.83863,0.79697,0.89913,0.83022,0.86311] },
  { pBar: 120, tC: 56.85, expected: [0.88383,0.87870,0.84553,0.92766,0.87211,0.89862] }
];

const TOL = 5e-4;

function runZValidationTests() {
  let results = '';
  let totalErr = 0, totalPts = 0;

  testCases.forEach(({ pBar, tC, expected }, idx) => {
    const T = tC + 273.15;        // K
    const P = pBar * 0.1;         // MPa
    results += `Test ${idx + 1}:  T = ${tC} °C,  P = ${pBar} bar\n`;

    expected.forEach((zRef, i) => {
      const xj = gasCompositions[i];
      try {
        const { Z } = compressibilityFactor(xj, T, P);
        const err   = Math.abs(Z - zRef);
        const pass  = err < TOL ? '✅' : '❌';
        results += `  Gas ${i + 1}:  Z = ${Z.toFixed(5)}  | Ref = ${zRef.toFixed(5)}  | Δ = ${err.toFixed(5)} ${pass}\n`;
        totalErr += err;
        totalPts++;
      } catch (e) {
        results += `  Gas ${i + 1}:  Error – ${e.message} ❌\n`;
      }
    });

    results += '\n';
  });

  document.getElementById('validationResults').textContent = results;
}

window.addEventListener('DOMContentLoaded', runZValidationTests);

// --- Reset button logic ---
const defaultValues = {
  temperature: 7,
  pressure: 120,
  methane: 0.9659,
  ethane: 0.02751,
  propane: 0.00046,
  isobutane: 0.00046,
  'n-butane': 0.00010,
  isopentane: 0.00004,
  'n-pentane': 0.00002,
  'n-hexane': 0.00002,
  'n-heptane': 0.0,
  'n-octane': 0.0,
  'n-nonane': 0.0,
  'n-decane': 0.0,
  helium: 0.0,
  argon: 0.0,
  nitrogen: 0.002,
  oxygen: 0.0,
  'carbon-monoxide': 0.0,
  'carbon-dioxide': 0.00349,
  hydrogen: 0.0,
  water: 0.0,
  'hydrogen-sulfide': 0.0
};

document.getElementById('resetButton').addEventListener('click', function() {
  clearUserInputs(); // Also clear saved values
  clearOrderMode(); // Also clear saved order mode
  document.getElementById('temperature').value = defaultValues.temperature;
  document.getElementById('pressure').value = defaultValues.pressure;
  for (const id in defaultValues) {
    if (id === 'temperature' || id === 'pressure') continue;
    const input = document.getElementById('mol_' + id);
    if (input) input.value = defaultValues[id];
  }
  reorderComponents(GROUPED_ORDER);
  updateButtonStates(document.getElementById('groupedOrder'));
  calculateZ();
  saveUserInputs(); // Save defaults as new state
  saveOrderMode('grouped'); // Save Grouped as default after reset
});
</script>

  <!-- Footer -->
  <footer class="container" style="margin-top: 5px; font-size: 0.9em;">
    <h2>How to compute natural gas Z factor and density with AGA8 92DC?</h2>
    <p>Enter gas composition temperature and pressure to calculate the compressibility factor Z and gas densities using AGA8 92DC in line with ISO 12213. Use the built in validation cases and the Z versus pressure chart to verify results quickly.</p>
    <p>You can switch component entry between Grouped order and AGA8 standard order which helps when comparing with published data. The Z factor graph updates automatically when inputs change. Results include molar density relative density mass density and base density. Molar density is in mol per cubic meter. Relative density is molecular weight compared to air. Mass density is at operating conditions. Base density is at standard conditions.</p>
    <p><strong>Disclaimer:</strong> This Gas Flow Calculator is provided for estimation and informational purposes only.
	The calculations made by this tool are based on general assumptions and may not reflect real-world operating conditions.
	While efforts have been made to ensure accuracy, we make no guarantees and accept no liability for errors or decisions made based on the results.
	Always consult a qualified engineer or technical expert before making operational decisions.</p>
  </footer>

</body>
</html>