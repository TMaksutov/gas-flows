<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-MYJRPRS3TW"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-MYJRPRS3TW');
  </script>
  <meta charset="utf-8">
  <title>AGA8-92DC Z-Factor Calculator | Natural Gas Compressibility</title>
  <link rel="canonical" href="https://gas-flows.com/aga8.html">
  <meta name="description" content="Calculate Z-factors and gas density for natural gas mixtures using the AGA8-92DC equation. Online compressibility factor calculator.">
  <meta name="keywords" content="
	AGA8, AGA8-92DC, z-factor calculator, compressibility factor, gas density, molar density, mass density,
	specific density, natural gas, gas flow calculator, natural gas compressibility,
	gas z-factor online, AGA8 calculator free, natural gas properties, gas mixture calculation
	">
<link rel="apple-touch-icon" sizes="57x57" href="apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="apple-icon-60x60.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="36x36" href="android-icon-36x36.png">
<link rel="icon" type="image/png" sizes="48x48" href="android-icon-48x48.png">
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="common.css">
</head>

<body>
  <nav>
    <ul>
      <li><a href="index.html">Flow Calculator</a></li>
      <li><a href="pressures.html">Pressure Converter</a></li>
      <li><a href="aga8.html" class="active">AGA8 Z-Factor</a></li>
      <li><a href="simulator.html">Gas flow Simulator</a></li>
      <li><a href="contacts.html">Contacts</a></li>
    </ul>
  </nav>

  <div class="container">
    <h2>AGA8-92DC Compressibility Factor Calculator</h2>

    <div class="field-group">
      <label for="temperature">Temperature (°C):</label>
      <input type="number" id="temperature" value="6" step="0.1">
      <span>– Gas temperature</span>
    </div>

    <div class="field-group">
      <label for="pressure">Pressure (bar):</label>
      <input type="number" id="pressure" value="120" step="0.01">
      <span>– Operating pressure</span>
    </div>

    <!-- Mole fractions: indexed 0..13 -->
<div class="field-group">
  <label for="mol_0">CO₂</label>
  <input id="mol_0" type="number" step="1e-5" value="0.006">
  <span>– Carbon Dioxide</span>
</div>
<div class="field-group">
  <label for="mol_1">N₂</label>
  <input id="mol_1" type="number" step="1e-5" value="0.003">
  <span>– Nitrogen</span>
</div>
<div class="field-group">
  <label for="mol_2">H₂</label>
  <input id="mol_2" type="number" step="1e-5" value="0.0">
  <span>– Hydrogen</span>
</div>
<div class="field-group">
  <label for="mol_3">CO</label>
  <input id="mol_3" type="number" step="1e-5" value="0.0">
  <span>– Carbon Monoxide</span>
</div>
<div class="field-group">
  <label for="mol_4">CH₄</label>
  <input id="mol_4" type="number" step="1e-5" value="0.965">
  <span>– Methane</span>
</div>
<div class="field-group">
  <label for="mol_5">C₂H₆</label>
  <input id="mol_5" type="number" step="1e-5" value="0.018">
  <span>– Ethane</span>
</div>
<div class="field-group">
  <label for="mol_6">C₃H₈</label>
  <input id="mol_6" type="number" step="1e-5" value="0.0045">
  <span>– Propane</span>
</div>
<div class="field-group">
  <label for="mol_7">i-C₄H₁₀</label>
  <input id="mol_7" type="number" step="1e-5" value="0.0010">
  <span>– Isobutane</span>
</div>
<div class="field-group">
  <label for="mol_8">n-C₄H₁₀</label>
  <input id="mol_8" type="number" step="1e-5" value="0.0010">
  <span>– n-Butane</span>
</div>
<div class="field-group">
  <label for="mol_9">i-C₅H₁₂</label>
  <input id="mol_9" type="number" step="1e-5" value="0.0005">
  <span>– Isopentane</span>
</div>
<div class="field-group">
  <label for="mol_10">n-C₅H₁₂</label>
  <input id="mol_10" type="number" step="1e-5" value="0.0003">
  <span>– n-Pentane</span>
</div>
<div class="field-group">
  <label for="mol_11">n-C₆H₁₄</label>
  <input id="mol_11" type="number" step="1e-5" value="0.0007">
  <span>– n-Hexane</span>
</div>
<div class="field-group">
  <label for="mol_12">n-C₇H₁₆</label>
  <input id="mol_12" type="number" step="1e-5" value="0.0">
  <span>– n-Heptane</span>
</div>
<div class="field-group">
  <label for="mol_13">n-C₈H₁₈</label>
  <input id="mol_13" type="number" step="1e-5" value="0.0">
  <span>– n-Octane</span>
</div>

    <h2>Results</h2>
	
<div class="field-group">
  <label for="densityResult">Molar density:</label>
  <input type="text" id="densityResult" readonly>
  <span>– Molar density (mol/m³)</span>
</div>

<div class="field-group">
  <label for="relativeResult">Relative Density:</label>
  <input type="text" id="relativeResult" readonly>
  <span>– Air-relative molecular weight (air ≈ 28.9647 g/mol)</span>
</div>

<div class="field-group">
  <label for="massDensityResult">Mass Density:</label>
  <input type="text" id="massDensityResult" readonly>
  <span>– Mass density (kg/m³)</span>
</div>

<div class="field-group">
  <label for="massDensityBaseResult">Base Density:</label>
  <input type="text" id="massDensityBaseResult" readonly>
  <span>– Standart condition  density (kg · m⁻³) (@ 20 °C, 101.325 kPa)</span>
</div>

<div class="field-group">
  <label for="zResult">Z-Factor:</label>
  <input type="text" id="zResult" readonly>
  <span>– Calculated compressibility</span>
</div>

  </div>
  <div class="container">
	<div class="field-group">
	  <canvas id="zChart" width="600" height="300"></canvas>
	</div>
</div>

 <div class="container">

  <label>Validation Results:</label>
  <pre id="validationResults" style="background:#f9f9f9;padding:10px;border:1px solid #ccc;max-height:120px;overflow:auto;"></pre>

</div>

    <!-- Load the AGA8 library as a regular script -->
<script src="constants.js"></script>
<script src="aga8.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Your calculation logic -->
<!-- Only the bottom part is changed; top remains unchanged -->
<!-- Main calculation logic -->
<script>
/* ------------------------------------------------------------------
   AGA8‑92DC front‑end helper
   – collects 14 user mole‑fraction inputs,
   – builds the 21‑component XJ vector in ISO order,
   – calls compressibilityFactor(xj, T [K], P [MPa]) from aga8.js,
   – displays Z, molar & mass density, and rel. density to air,
     plus a quick Z‑vs‑P chart (0‑250 bar).
------------------------------------------------------------------ */

function calculateZ () {
    const tol          = 1e-6;
    const molInputs    = [];
    let   moleSum      = 0;

    // gather 14 user mole‑fraction inputs
    for (let i = 0; i <= 13; i++) {
      const v = parseFloat(document.getElementById('mol_' + i).value) || 0;
      molInputs.push(v);
      moleSum += v;
    }

    // result fields
    const zField       = document.getElementById('zResult');
    const densityField = document.getElementById('densityResult');
    const massField    = document.getElementById('massDensityResult');
    const relField     = document.getElementById('relativeResult');
    const baseField    = document.getElementById('massDensityBaseResult');

    // temperature & pressure (operating)
    const T_C  = parseFloat(document.getElementById('temperature').value);
    const T    = T_C + 273.15;                // K
    const Pbar = parseFloat(document.getElementById('pressure').value);
    const P    = Pbar * 0.1;                  // MPa  (1 bar = 0.1 MPa)

    if (Math.abs(moleSum - 1) > tol) {
      zField.value   = `Σx = ${moleSum.toFixed(6)} ❌`;
      densityField.value = massField.value = relField.value = baseField.value = '';
      if (window.zChart instanceof Chart) window.zChart.destroy();
      return;
    }

    // build 21‑component vector in ISO order (indices per constants)
    const xj = Array(21).fill(0);
    xj[2]  = molInputs[0];  xj[1]  = molInputs[1];  xj[18] = molInputs[2];  xj[17] = molInputs[3];
    xj[0]  = molInputs[4];  xj[3]  = molInputs[5];  xj[4]  = molInputs[6];  xj[5]  = molInputs[7];
    xj[6]  = molInputs[8];  xj[7]  = molInputs[9];  xj[8]  = molInputs[10]; xj[9]  = molInputs[11];
    xj[10] = molInputs[12]; xj[11] = molInputs[13];

    try {
      /* ── operating conditions ─────────────────────────────────────── */
      const { Z, D } = compressibilityFactor(xj, T, P); // D → kmol·m⁻³
      zField.value       = Z.toFixed(3);
      densityField.value = D.toFixed(4);

      const M_mix = calculateMolarMass(xj);            // g·mol⁻¹
      const rho   = D * M_mix;                         // kg·m⁻³ (D kmol/m³ × g/mol × 1 kg/1000 g × 1000 mol/kmol)
      massField.value = rho.toFixed(3);

      relField.value = (M_mix / 28.9647).toFixed(3);

      /* ── base‑condition density (20 °C & 101.325 kPa) ─────────────── */
      const Tbase = 293.15;          // 20 °C in K
      const Pbase = 0.101325;        // 101.325 kPa = 0.101325 MPa
      const { D: Dbase } = compressibilityFactor(xj, Tbase, Pbase);
      const rhoBase = Dbase * M_mix; // kg·m⁻³
      baseField.value = rhoBase.toFixed(3);

      updateZChart(xj, T);
    } catch (err) {
      zField.value = `Error: ${err.message} ❌`;
      densityField.value = massField.value = relField.value = baseField.value = '';
      if (window.zChart instanceof Chart) window.zChart.destroy();
    }
  }

  function calculateMolarMass (xj) {
    return xj.reduce((sum, x, i) => sum + x * MW[i], 0);
  }

/* ─── Helpers ──────────────────────────────────────────────────── */

function calculateMolarMass(xj) {
  return xj.reduce((sum, x, i) => sum + x * MW[i], 0);   // MW[] from constants.js
}

function updateZChart(xj, T) {
  const pressures = [];
  const zValues   = [];

  for (let pb = 0; pb <= 250; pb += 5) {
    const MPa = pb * 0.1;
    try {
      const { Z } = compressibilityFactor(xj, T, MPa);
      pressures.push(pb);
      zValues.push(Z);
    } catch {
      pressures.push(pb);
      zValues.push(null);   // missing point if solver fails (rare)
    }
  }

  const ctx = document.getElementById('zChart').getContext('2d');
  if (window.zChart instanceof Chart) window.zChart.destroy();

  window.zChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: pressures,
      datasets: [{
        label: 'Z‑Factor vs Pressure (bar)',
        data: zValues,
        borderWidth: 2,
        borderColor: 'blue',
        fill: false,
        pointRadius: 0
      }]
    },
    options: {
      responsive: true,
      scales: {
        x: { title: { display: true, text: 'Pressure (bar)' } },
        y: { title: { display: true, text: 'Z‑Factor' }, beginAtZero: false }
      },
      plugins: { legend: { display: true } }
    }
  });
}

/* ─── Initialise ───────────────────────────────────────────────── */
window.addEventListener('DOMContentLoaded', () => {
  calculateZ();  // auto‑calculate on page load
  document.querySelectorAll(
    '#temperature, #pressure, input[id^="mol_"]'
  ).forEach(el => el.addEventListener('input', calculateZ));
});
</script>


<script>
/* --- helper: 14‑component → 21‑component XJ mapping (unchanged) -------- */
function map14to21(src14) {
  const xj = Array(21).fill(0);
  [
    [ 0, 4],  [ 1, 5],  [ 2, 6],  [ 3, 7],  [ 4, 8],
    [ 5, 9],  [ 6,10],  [ 7,11],  [ 8,12],  [ 9,13],
    [12, 0],  [13, 1],  [19, 2],  [20, 3]
  ].forEach(([xIdx, srcIdx]) => { xj[xIdx] = src14[srcIdx]; });
  return xj;
}

/* --- ISO Annex F – six reference mixtures ----------------------------- */
/* order inside each array:                                             */
/*  CO2, N2, H2, CO, CH4, C2H6, C3H8, i‑C4, n‑C4, i‑C5, n‑C5, C6, C7, C8 */

const gasCompositions = [
  /* Gas 1 */ [0.006, 0.003, 0.000, 0.000,
               0.965, 0.0180, 0.0045,
               0.0010, 0.0010, 0.0005, 0.0003, 0.0007,
               0.0000, 0.0000],

  /* Gas 2 */ [0.005, 0.031, 0.000, 0.000,
               0.907, 0.0450, 0.0084,
               0.0010, 0.0015, 0.0003, 0.0004, 0.0004,
               0.0000, 0.0000],

  /* Gas 3 */ [0.015, 0.010, 0.000, 0.000,
               0.859, 0.0850, 0.0230,
               0.0035, 0.0035, 0.0005, 0.0005, 0.0002,
               0.0000, 0.0000],

  /* Gas 4 */ [0.016, 0.100, 0.095, 0.010,
               0.735, 0.0330, 0.0074,
               0.0012, 0.0012, 0.0004, 0.0004, 0.0002,
               0.0001, 0.0001],

  /* Gas 5 */ [0.076, 0.057, 0.000, 0.000,
               0.812, 0.0430, 0.0090,
               0.0015, 0.0015, 0.0000, 0.0000, 0.0000,
               0.0000, 0.0000],

  /* Gas 6 */ [0.011, 0.117, 0.000, 0.000,
               0.826, 0.0350, 0.0075,
               0.0012, 0.0012, 0.0004, 0.0004, 0.0002,
               0.0001, 0.0000]
];


/* --- ISO reference Z‑values & tolerance (unchanged) ------------------- */
const testCases = [
  { pBar: 60,  tC: -3.15, expected: [0.84053,0.83348,0.79380,0.88550,0.82609,0.85380] },
  { pBar: 60,  tC: 6.85,  expected: [0.86199,0.85596,0.82206,0.90144,0.84969,0.87370] },
  { pBar: 60,  tC: 36.85, expected: [0.90867,0.90466,0.88183,0.93674,0.90052,0.91723] },
  { pBar: 60,  tC: 56.85, expected: [0.93011,0.92696,0.90868,0.95318,0.92368,0.93730] },
  { pBar: 120, tC: -3.15, expected: [0.72133,0.71044,0.64145,0.81020,0.69540,0.75074] },
  { pBar: 120, tC: 6.85,  expected: [0.76025,0.75061,0.68971,0.83762,0.73780,0.78586] },
  { pBar: 120, tC: 16.85, expected: [0.79317,0.78475,0.73123,0.86137,0.77369,0.81569] },
  { pBar: 120, tC: 36.85, expected: [0.84515,0.83863,0.79697,0.89913,0.83022,0.86311] },
  { pBar: 120, tC: 56.85, expected: [0.88383,0.87870,0.84553,0.92766,0.87211,0.89862] }
];

const TOL = 5e-4;

/* --- Run the suite ---------------------------------------------------- */
function runZValidationTests() {
  let results = '';
  let totalErr = 0, totalPts = 0;

  testCases.forEach(({ pBar, tC, expected }, idx) => {
    const T = tC + 273.15;        // K
    const P = pBar * 0.1;         // MPa
    results += `Test ${idx + 1}:  T = ${tC} °C,  P = ${pBar} bar\n`;

    expected.forEach((zRef, i) => {
      const xj = map14to21(gasCompositions[i]);
      try {
        const { Z } = compressibilityFactor(xj, T, P);
        const err   = Math.abs(Z - zRef);
        const pass  = err < TOL ? '✅' : '❌';
        results += `  Gas ${i + 1}:  Z = ${Z.toFixed(5)}  | Ref = ${zRef.toFixed(5)}  | Δ = ${err.toFixed(5)} ${pass}\n`;
        totalErr += err;
        totalPts++;
      } catch (e) {
        results += `  Gas ${i + 1}:  Error – ${e.message} ❌\n`;
      }
    });

    results += '\n';
  });

  document.getElementById('validationResults').textContent = results;
}

/* auto‑run on page load */
window.addEventListener('DOMContentLoaded', runZValidationTests);
</script>






</body>
</html>
